# LangPrompt è®¾è®¡æ–‡æ¡£

## é¡¹ç›®æ¦‚è¿°

LangPrompt æ˜¯ Prompt ç®¡ç†ç•Œçš„ Github + Apollo çš„ç»“åˆã€‚

### æ ¸å¿ƒç»„ä»¶
- **Server ç«¯**: ç”¨äº Prompt çš„ç®¡ç†ç¼–è¾‘åç«¯ï¼Œä½¿ç”¨ Python FastAPI
- **å‰ç«¯**: åŸºäº TypeScript çš„ç”¨æˆ·ç•Œé¢
- **SDK**: å®¢æˆ·ç«¯å¯¹æç¤ºè¯çš„ä½¿ç”¨å’Œç®¡ç†å·¥å…·

### æ ¸å¿ƒç‰¹æ€§
- ğŸ”„ **å®Œæ•´çš„ç‰ˆæœ¬ç®¡ç†**: ç±»ä¼¼ Git çš„ç‰ˆæœ¬æ§åˆ¶æœºåˆ¶
- ğŸ” **ä¼ä¸šçº§æƒé™ç®¡ç†**: å¤šå±‚çº§è§’è‰²æƒé™æ§åˆ¶
- ğŸš€ **é«˜æ€§èƒ½ API**: å¼‚æ­¥å¤„ç†ï¼Œæ”¯æŒå¤§è§„æ¨¡å¹¶å‘
- ğŸ“Š **çµæ´»çš„å…ƒæ•°æ®**: æ”¯æŒè‡ªå®šä¹‰é…ç½®å’Œæ ‡ç­¾ç®¡ç†

## è®¾è®¡æ€è·¯

### æ ¸å¿ƒæ¦‚å¿µ

**æ•°æ®å±‚çº§ç»“æ„**:
```
é¡¹ç›® (Project)
 â””â”€â”€ æç¤ºè¯ (Prompt)
      â””â”€â”€ ç‰ˆæœ¬ (Version)
```

**ä½¿ç”¨é€»è¾‘**:
- **é¡¹ç›®** > **æç¤ºè¯** > **æç¤ºè¯ç‰ˆæœ¬**
- æç¤ºè¯åç§°æ”¯æŒåˆ†ç±»å‘½åï¼ˆå¦‚ `category/prompt_name`ï¼‰ï¼Œç±»ä¼¼å¯¹è±¡å­˜å‚¨çš„æ–‡ä»¶å¤¹ç»“æ„
- é¡¹ç›®å¯ä»¥æ‰“æ ‡ç­¾ï¼Œæ ‡ç­¾å¯ä»¥é‡å¤ä½¿ç”¨
- æ¯ä¸ªæç¤ºè¯éƒ½æœ‰ç‹¬ç«‹çš„ç‰ˆæœ¬ç®¡ç†
- æ¯ä¸ªç‰ˆæœ¬å¯ä»¥æ‰“æ ‡ç­¾ï¼Œä½†åŒä¸€æç¤ºè¯ä¸‹çš„æ ‡ç­¾å…·æœ‰å”¯ä¸€æ€§

### ç‰ˆæœ¬ç®¡ç†è®¾è®¡åŸåˆ™

#### Git-like ç‰ˆæœ¬ä¸å¯å˜æ€§

LangPrompt é‡‡ç”¨ç±»ä¼¼ Git çš„ç‰ˆæœ¬ç®¡ç†æœºåˆ¶ï¼Œç¡®ä¿ç‰ˆæœ¬å†å²çš„å®Œæ•´æ€§å’Œå¯è¿½æº¯æ€§ï¼š

**ä¸å¯å˜å­—æ®µï¼ˆä¸€æ—¦åˆ›å»ºä¸å¯ä¿®æ”¹ï¼‰**:
- `prompt`: æç¤ºè¯å†…å®¹æœ¬ä½“
- `version`: ç‰ˆæœ¬å·
- `commit_message`: æäº¤ä¿¡æ¯
- `created_at`: åˆ›å»ºæ—¶é—´
- `created_by`: åˆ›å»ºè€…
- `prompt_id`ã€`project_id`: å…³è”å…³ç³»

**å¯å˜å­—æ®µï¼ˆå¯ä»¥åç»­æ›´æ–°ï¼‰**:
- `labels`: ç‰ˆæœ¬æ ‡ç­¾æ•°ç»„ï¼ˆç”¨äºæ ‡è®° productionã€staging ç­‰ï¼‰
- `metadata`: ç‰ˆæœ¬å…ƒæ•°æ®ï¼ˆç”¨äºå­˜å‚¨é¢å¤–çš„é…ç½®æˆ–ä¿¡æ¯ï¼‰
- `updated_at`: æ›´æ–°æ—¶é—´ï¼ˆè‡ªåŠ¨ç»´æŠ¤ï¼‰

#### ç‰ˆæœ¬æ“ä½œæ¨¡å¼

- **åˆ›å»ºæ–°ç‰ˆæœ¬**: æäº¤å…¨æ–°çš„æç¤ºè¯å†…å®¹ï¼Œè‡ªåŠ¨é€’å¢ç‰ˆæœ¬å·
- **æ›´æ–°ç‰ˆæœ¬æ ‡ç­¾**: ä»…æ›´æ–°ç‰ˆæœ¬çš„æ ‡ç­¾å’Œå…ƒæ•°æ®ï¼Œä¸å½±å“æ ¸å¿ƒå†…å®¹
- **ç‰ˆæœ¬å†å²ä¿æŒ**: ç‰ˆæœ¬ä¸å¯åˆ é™¤ï¼Œä¿æŒå®Œæ•´çš„å†å²è®°å½•

#### Label ç®¡ç†è§„åˆ™

- **å”¯ä¸€æ€§çº¦æŸ**: åŒä¸€ä¸ªæç¤ºè¯ä¸‹ï¼Œæ¯ä¸ª label åªèƒ½æ ‡è®°ä¸€ä¸ªç‰ˆæœ¬
- **å¸¸ç”¨æ ‡ç­¾**: `production`ã€`staging`ã€`development`ã€`deprecated`ã€`hotfix`
- **æ ‡ç­¾è¿ç§»**: æ”¯æŒç‰ˆæœ¬é—´çš„æ ‡ç­¾åŠ¨æ€è°ƒæ•´

### æƒé™ç®¡ç†æ¶æ„

#### è®¤è¯æœºåˆ¶

**åŒé‡è®¤è¯æ¨¡å¼**:
- **JWT Token**: Web ç«¯ç”¨æˆ·è®¤è¯ï¼Œæ”¯æŒçŸ­æœŸä»¤ç‰Œ + åˆ·æ–°ä»¤ç‰Œæœºåˆ¶
- **API Key**: SDK å’Œè„šæœ¬é›†æˆè®¤è¯ï¼Œæ”¯æŒé•¿æœŸæœ‰æ•ˆæ€§å’Œä½œç”¨åŸŸæ§åˆ¶

#### æƒé™å±‚çº§

é¡¹ç›®çº§æƒé™ç®¡ç†ï¼Œæ”¯æŒä»¥ä¸‹è§’è‰²å±‚çº§ï¼š

| è§’è‰² | æƒé™èŒƒå›´ | å…·ä½“æƒé™ |
|------|----------|----------|
| **Owner** | é¡¹ç›®æ‰€æœ‰è€… | é¡¹ç›®åˆ é™¤ã€æˆå‘˜ç®¡ç†ã€æ‰€æœ‰è¯»å†™æƒé™ |
| **Admin** | é¡¹ç›®ç®¡ç†å‘˜ | æˆå‘˜ç®¡ç†ã€æ‰€æœ‰è¯»å†™æƒé™ï¼ˆä¸èƒ½åˆ é™¤é¡¹ç›®ï¼‰ |
| **Editor** | ç¼–è¾‘è€… | æç¤ºè¯åˆ›å»ºã€ç¼–è¾‘ã€ç‰ˆæœ¬ç®¡ç†ã€åªè¯»é¡¹ç›®ä¿¡æ¯ |
| **Viewer** | æŸ¥çœ‹è€… | ä»…æŸ¥çœ‹é¡¹ç›®ã€æç¤ºè¯å’Œç‰ˆæœ¬ï¼Œæ— ç¼–è¾‘æƒé™ |

#### æƒé™æ§åˆ¶è§„åˆ™

1. **è‡ªåŠ¨æƒé™åˆ†é…**: é¡¹ç›®åˆ›å»ºè€…è‡ªåŠ¨æˆä¸º Owner
2. **æˆå‘˜ç®¡ç†æƒé™**: ä»… Owner/Admin å¯æ·»åŠ /ç§»é™¤æˆå‘˜
3. **è§’è‰²è½¬è®©**: ä»… Owner å¯è½¬è®© Owner æƒé™
4. **é¡¹ç›®åˆ é™¤**: ä»… Owner å¯åˆ é™¤é¡¹ç›®
5. **API Key ç»§æ‰¿**: API Key ç»§æ‰¿ç”¨æˆ·åœ¨é¡¹ç›®ä¸­çš„æœ€é«˜æƒé™

### ä¸šåŠ¡æµç¨‹è®¾è®¡

#### é¡¹ç›®ç”Ÿå‘½å‘¨æœŸ

```mermaid
graph TD
    A[åˆ›å»ºé¡¹ç›®] --> B[æ·»åŠ æˆå‘˜]
    B --> C[åˆ›å»ºæç¤ºè¯]
    C --> D[åˆ›å»ºç‰ˆæœ¬]
    D --> E[ç‰ˆæœ¬æ ‡ç­¾ç®¡ç†]
    E --> F[å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒ]
    F --> G[ç‰ˆæœ¬è¿­ä»£]
    G --> D
```

#### ç‰ˆæœ¬å‘å¸ƒæµç¨‹

```mermaid
graph LR
    A[å¼€å‘ç‰ˆæœ¬] --> B[æµ‹è¯•ç‰ˆæœ¬]
    B --> C[é¢„å‘å¸ƒç‰ˆæœ¬]
    C --> D[ç”Ÿäº§ç‰ˆæœ¬]
    D --> E[ç‰ˆæœ¬ç»´æŠ¤]
```

**æ ‡ç­¾æµè½¬ç¤ºä¾‹**:
- ç‰ˆæœ¬ 1: `development` â†’ `staging` â†’ `production`
- ç‰ˆæœ¬ 2: `development` â†’ `staging`
- ç‰ˆæœ¬ 3: `development`

#### æƒé™éªŒè¯æµç¨‹

```mermaid
graph TD
    A[ç”¨æˆ·è¯·æ±‚] --> B{è®¤è¯æ£€æŸ¥}
    B -->|JWT Token| C[éªŒè¯ Token]
    B -->|API Key| D[éªŒè¯ API Key]
    C --> E[è·å–ç”¨æˆ·ä¿¡æ¯]
    D --> E
    E --> F[æƒé™æ£€æŸ¥]
    F -->|é€šè¿‡| G[æ‰§è¡Œæ“ä½œ]
    F -->|å¤±è´¥| H[è¿”å›æƒé™é”™è¯¯]
```

## ç³»ç»Ÿæ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```mermaid
graph TB
    subgraph "å‰ç«¯å±‚"
        A[Web UI]
        B[Mobile App]
    end

    subgraph "API å±‚"
        C[è®¤è¯æœåŠ¡]
        D[é¡¹ç›®ç®¡ç†]
        E[ç‰ˆæœ¬æ§åˆ¶]
        F[æƒé™ç®¡ç†]
    end

    subgraph "ä¸šåŠ¡å±‚"
        G[æƒé™æ£€æŸ¥å™¨]
        H[ç‰ˆæœ¬ç®¡ç†å™¨]
        I[æ ‡ç­¾ç®¡ç†å™¨]
    end

    subgraph "æ•°æ®å±‚"
        J[PostgreSQL]
        K[Redis ç¼“å­˜]
    end

    A --> C
    A --> D
    A --> E
    B --> C
    B --> D
    B --> E

    C --> G
    D --> H
    E --> I

    G --> J
    H --> J
    I --> J
    G --> K
    H --> K
```

### æ ¸å¿ƒæ¨¡å—

#### 1. è®¤è¯ä¸æƒé™æ¨¡å—
- **JWT å¤„ç†å™¨**: ä»¤ç‰Œç”Ÿæˆã€éªŒè¯ã€åˆ·æ–°
- **API Key ç®¡ç†**: Key ç”Ÿæˆã€éªŒè¯ã€ä½œç”¨åŸŸæ§åˆ¶
- **æƒé™æ£€æŸ¥å™¨**: ç»Ÿä¸€çš„æƒé™éªŒè¯é€»è¾‘
- **ä¸­é—´ä»¶**: FastAPI ä¾èµ–æ³¨å…¥é›†æˆ

#### 2. ç‰ˆæœ¬ç®¡ç†æ¨¡å—
- **ç‰ˆæœ¬åˆ›å»º**: è‡ªåŠ¨ç‰ˆæœ¬å·é€’å¢ï¼Œå†…å®¹ä¸å¯å˜
- **æ ‡ç­¾ç®¡ç†**: ç‰ˆæœ¬æ ‡ç­¾çš„å”¯ä¸€æ€§æ§åˆ¶
- **å†å²æŸ¥è¯¢**: ç‰ˆæœ¬å†å²å’Œå·®å¼‚å¯¹æ¯”
- **å…ƒæ•°æ®ç®¡ç†**: çµæ´»çš„é…ç½®ä¿¡æ¯å­˜å‚¨

#### 3. é¡¹ç›®ç®¡ç†æ¨¡å—
- **é¡¹ç›® CRUD**: å®Œæ•´çš„é¡¹ç›®ç”Ÿå‘½å‘¨æœŸç®¡ç†
- **æˆå‘˜ç®¡ç†**: è§’è‰²åˆ†é…å’Œæƒé™æ§åˆ¶
- **è½¯åˆ é™¤**: æ•°æ®ä¿æŠ¤å’Œæ¢å¤æœºåˆ¶

## æ•°æ®æ¨¡å‹è®¾è®¡

### æ ¸å¿ƒå®ä½“å…³ç³»

```mermaid
erDiagram
    User ||--o{ Project : creates
    User ||--o{ ProjectMember : participates
    Project ||--o{ Prompt : contains
    Prompt ||--o{ PromptVersion : has_versions
    User ||--o{ ApiKey : owns

    User {
        uuid id
        string username
        string email
        string password_hash
        boolean is_active
    }

    Project {
        uuid id
        string name
        text description
        uuid created_by
        array tags
        jsonb metadata
        boolean is_deleted
    }

    ProjectMember {
        uuid id
        uuid project_id
        uuid user_id
        enum role
        boolean is_active
    }

    Prompt {
        uuid id
        string name
        text description
        uuid project_id
        string type
        array tags
    }

    PromptVersion {
        uuid id
        uuid prompt_id
        integer version
        jsonb prompt
        jsonb metadata
        array labels
        text commit_message
    }
```

### ç‰ˆæœ¬ä¸å¯å˜æ€§è®¾è®¡

**ä¸å¯å˜å­—æ®µ**ï¼ˆğŸ”’ï¼‰:
- ç‰ˆæœ¬å†…å®¹ (`prompt`)
- ç‰ˆæœ¬å· (`version`)
- æäº¤ä¿¡æ¯ (`commit_message`)
- æ—¶é—´æˆ³ (`created_at`)
- åˆ›å»ºè€… (`created_by`)

**å¯å˜å­—æ®µ**ï¼ˆâœï¸ï¼‰:
- ç‰ˆæœ¬æ ‡ç­¾ (`labels`)
- å…ƒæ•°æ® (`metadata`)
- æ›´æ–°æ—¶é—´ (`updated_at`)

## API è®¾è®¡åŸåˆ™

### RESTful æ¥å£è§„èŒƒ

**èµ„æºå‘½å**:
```
GET    /api/v1/projects                    # è·å–é¡¹ç›®åˆ—è¡¨
POST   /api/v1/projects                    # åˆ›å»ºé¡¹ç›®
GET    /api/v1/projects/{id}               # è·å–é¡¹ç›®è¯¦æƒ…
PUT    /api/v1/projects/{id}               # æ›´æ–°é¡¹ç›®
DELETE /api/v1/projects/{id}               # åˆ é™¤é¡¹ç›®

GET    /api/v1/projects/{id}/prompts       # è·å–é¡¹ç›®ä¸‹çš„æç¤ºè¯
POST   /api/v1/projects/{id}/prompts       # åˆ›å»ºæç¤ºè¯
GET    /api/v1/projects/{id}/prompts/{id}/versions  # è·å–ç‰ˆæœ¬åˆ—è¡¨
POST   /api/v1/projects/{id}/prompts/{id}/versions  # åˆ›å»ºæ–°ç‰ˆæœ¬
```

### å“åº”æ ¼å¼æ ‡å‡†

**æˆåŠŸå“åº”**:
```json
{
  "success": true,
  "data": {},
  "message": "æ“ä½œæˆåŠŸ"
}
```

**é”™è¯¯å“åº”**:
```json
{
  "success": false,
  "error": {
    "error_code": "PERMISSION_DENIED",
    "message": "æƒé™ä¸è¶³",
    "details": {}
  }
}
```

### æƒé™æ³¨è§£ç¤ºä¾‹

```python
@router.get("/projects/{project_id}")
async def get_project(
    project_id: UUID,
    current_user: User = Depends(require_project_permission(RoleEnum.VIEWER))
):
    """æŸ¥çœ‹é¡¹ç›® - éœ€è¦ Viewer æƒé™"""
    pass

@router.put("/projects/{project_id}")
async def update_project(
    project_id: UUID,
    current_user: User = Depends(require_project_permission(RoleEnum.ADMIN))
):
    """æ›´æ–°é¡¹ç›® - éœ€è¦ Admin æƒé™"""
    pass
```

## å®‰å…¨è®¾è®¡

### è®¤è¯å®‰å…¨
- **å¯†ç å®‰å…¨**: bcrypt å“ˆå¸Œ + ç›å€¼
- **JWT å®‰å…¨**: çŸ­æœŸè®¿é—®ä»¤ç‰Œ + é•¿æœŸåˆ·æ–°ä»¤ç‰Œ
- **API Key å®‰å…¨**: å“ˆå¸Œå­˜å‚¨ + ä½œç”¨åŸŸé™åˆ¶

### æƒé™å®‰å…¨
- **æœ€å°æƒé™åŸåˆ™**: ç”¨æˆ·åªèƒ½è®¿é—®å¿…è¦çš„èµ„æº
- **æƒé™æ£€æŸ¥**: æ¯ä¸ª API éƒ½æœ‰æ˜ç¡®çš„æƒé™è¦æ±‚
- **å®¡è®¡æ—¥å¿—**: è®°å½•æ‰€æœ‰é‡è¦æ“ä½œçš„æ—¥å¿—

### æ•°æ®å®‰å…¨
- **è½¯åˆ é™¤**: é‡è¦æ•°æ®ä¸ç‰©ç†åˆ é™¤
- **æ•°æ®åŠ å¯†**: æ•æ„Ÿæ•°æ®ä¼ è¾“å’Œå­˜å‚¨åŠ å¯†
- **å¤‡ä»½ç­–ç•¥**: å®šæœŸæ•°æ®å¤‡ä»½å’Œæ¢å¤æµ‹è¯•

## æ‰©å±•æ€§è®¾è®¡

### æ°´å¹³æ‰©å±•
- **æ— çŠ¶æ€è®¾è®¡**: API æœåŠ¡æ— çŠ¶æ€ï¼Œæ”¯æŒå¤šå®ä¾‹éƒ¨ç½²
- **æ•°æ®åº“åˆ†ç‰‡**: æ”¯æŒæŒ‰é¡¹ç›®æˆ–ç”¨æˆ·è¿›è¡Œæ•°æ®åˆ†ç‰‡
- **ç¼“å­˜ç­–ç•¥**: Redis ç¼“å­˜çƒ­ç‚¹æ•°æ®

### åŠŸèƒ½æ‰©å±•
- **æ’ä»¶ç³»ç»Ÿ**: æ”¯æŒç¬¬ä¸‰æ–¹æ’ä»¶æ‰©å±•åŠŸèƒ½
- **æ¨¡æ¿å¸‚åœº**: æç¤ºè¯æ¨¡æ¿å…±äº«å’Œå¤ç”¨
- **å¤šè¯­è¨€æ”¯æŒ**: å›½é™…åŒ–å’Œæœ¬åœ°åŒ–æ”¯æŒ

## æ–‡æ¡£ä½“ç³»

æœ¬è®¾è®¡æ–‡æ¡£é…å¥—ä»¥ä¸‹æŠ€æœ¯æ–‡æ¡£ï¼š

1. **[æŠ€æœ¯å®ç°æ–‡æ¡£](./æŠ€æœ¯å®ç°æ–‡æ¡£.md)** - è¯¦ç»†çš„æŠ€æœ¯å®ç°å’Œä»£ç ç»“æ„
2. **[API æ¥å£æ–‡æ¡£](./APIæ¥å£æ–‡æ¡£.md)** - å®Œæ•´çš„ API ä½¿ç”¨è¯´æ˜
3. **[æ•°æ®åº“è®¾è®¡æ–‡æ¡£](./æ•°æ®åº“è®¾è®¡æ–‡æ¡£.md)** - æ•°æ®åº“è¡¨ç»“æ„å’Œä¼˜åŒ–ç­–ç•¥
4. **[æµ‹è¯•è®¾è®¡æ–‡æ¡£](./æµ‹è¯•è®¾è®¡æ–‡æ¡£.md)** - æµ‹è¯•ç­–ç•¥å’Œè‡ªåŠ¨åŒ–æµ‹è¯•

## é¡¹ç›®é‡Œç¨‹ç¢‘

### Phase 1: æ ¸å¿ƒåŠŸèƒ½ âœ…
- ç”¨æˆ·è®¤è¯å’Œæƒé™ç®¡ç†
- é¡¹ç›®ç®¡ç†åŸºç¡€åŠŸèƒ½
- ç‰ˆæœ¬æ§åˆ¶æ ¸å¿ƒé€»è¾‘
- åŸºç¡€ API æ¥å£

### Phase 2: åŠŸèƒ½å®Œå–„ (è¿›è¡Œä¸­)
- æç¤ºè¯ç®¡ç†å®Œæ•´åŠŸèƒ½
- ç‰ˆæœ¬ç®¡ç† UI ç•Œé¢
- æˆå‘˜ç®¡ç†å’Œåä½œåŠŸèƒ½
- æ€§èƒ½ä¼˜åŒ–å’Œå®‰å…¨åŠ å›º

### Phase 3: ç”Ÿæ€å»ºè®¾ (è®¡åˆ’ä¸­)
- SDK å¼€å‘å’Œå‘å¸ƒ
- æ¨¡æ¿å¸‚åœºå’Œç¤¾åŒº
- ç¬¬ä¸‰æ–¹é›†æˆå’Œæ’ä»¶ç³»ç»Ÿ
- ä¼ä¸šçº§ç‰¹æ€§æ”¯æŒ

é€šè¿‡æ¸…æ™°çš„æ¶æ„è®¾è®¡å’Œæ¸è¿›å¼å¼€å‘ï¼ŒLangPrompt å°†æˆä¸º Prompt ç®¡ç†é¢†åŸŸçš„é¢†å…ˆè§£å†³æ–¹æ¡ˆã€‚